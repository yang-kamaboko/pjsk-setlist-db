/* =============================================
   ★ 手机端终极修复 (Mobile Final Fix) ★
   包含：
   1. 黄色排行榜按钮独占一行
   2. 排行榜标签左右分开
   3. 【新】歌单详情页按钮改为两列网格，防止溢出
   4. 【新】歌单标题避开关闭按钮
   ============================================= */
@media (max-width: 850px) {

    /* --- Part 0: 全局容器优化 --- */
    .container {
        padding: 0 6px !important;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
    }

    /* --- Part 1: 顶部主页按钮组 --- */
    .view-toggle {
        width: 100% !important;
        min-width: 0 !important;
        padding: 0 5px !important;
        box-sizing: border-box;
        gap: 8px !important;
        justify-content: flex-start !important;
    }

    /* 黄色排行榜按钮：独占一行 */
    .ranking-main-btn {
        width: 100% !important;      
        flex: none !important;
        margin: 0 0 5px 0 !important;
        font-size: 0.95em !important;
        padding: 12px 0 !important;
    }

    /* 其他普通按钮：一行两个 */
    .view-btn:not(.ranking-main-btn) {
        width: calc(50% - 4px) !important; 
        flex: none !important;
        min-width: 0 !important;
        margin: 0 !important;
        font-size: 0.85em !important;
        padding: 10px 2px !important;
    }
    
    .rank-count-box, .rank-tags.mobile-hidden { display: none !important; }

    /* --- Part 2: 排行榜 Grid 布局 (保持之前修复) --- */
    .ranking-row {
        display: grid !important;
        grid-template-columns: 30px 55px 1fr !important;
        grid-template-rows: auto auto !important;
        gap: 4px 10px !important;
        padding: 10px !important;
        height: auto !important;
        align-items: center !important;
    }

    .rank-num { grid-column: 1 !important; grid-row: 1 / 3 !important; font-size: 1.2em !important; text-align: center !important; margin: 0 !important; justify-self: center !important; }
    .rank-cover { grid-column: 2 !important; grid-row: 1 / 3 !important; width: 50px !important; height: 50px !important; border-radius: 6px !important; margin: 0 !important; object-fit: cover; }
    .rank-song-info { grid-column: 3 !important; grid-row: 1 !important; width: 100% !important; display: flex !important; align-items: flex-end !important; min-width: 0 !important; padding-bottom: 2px !important; }
    .rank-song-info div[style*="font-weight:bold"] { font-size: 1em !important; line-height: 1.2 !important; white-space: nowrap !important; overflow: hidden !important; text-overflow: ellipsis !important; width: 100% !important; }

    /* 数据栏：左右两端对齐 */
    .rank-meta-mobile {
        grid-column: 3 !important; grid-row: 2 !important;
        display: flex !important; flex-direction: row !important; align-items: center !important;
        justify-content: space-between !important; 
        width: 100% !important; margin: 0 !important; padding: 0 !important; border: none !important; overflow-x: hidden !important; 
    }
    .rank-meta-mobile > div:first-child span { font-size: 0.75em !important; background-color: #e0f7fa !important; color: #00acc1 !important; padding: 2px 6px !important; border-radius: 4px !important; display: inline-block !important; font-weight: bold !important; white-space: nowrap !important; flex-shrink: 0 !important; }
    .rank-meta-mobile > div:last-child { display: flex !important; justify-content: flex-end !important; gap: 3px !important; flex-wrap: nowrap !important; overflow-x: auto !important; max-width: 80% !important; }
    .rank-tag { font-size: 0.65em !important; padding: 2px 6px !important; height: auto !important; white-space: nowrap !important; display: inline-block !important; margin: 0 !important; }

    /* --- Part 3: 详情页 (Setlist) 重点修复 --- */
    
    /* 1. 弹窗头部：改为竖向排列，防止被挤爆 */
    .setlist-header { 
        display: flex !important;
        flex-direction: column !important; 
        gap: 10px !important; 
        width: 100% !important;
        padding-right: 0 !important;
    }
    
    /* 2. 标题：允许换行，并给右边的关闭按钮留出安全距离 */
    .setlist-title { 
        font-size: 1.2em !important;
        white-space: normal !important; /* 允许换行 */
        line-height: 1.3 !important;
        padding-right: 40px !important; /* ★ 关键：防止文字被右上角的X挡住 */
        width: 100% !important;
        box-sizing: border-box !important;
    }

    /* 3. 场次切换按钮：改为网格布局 (2列)，完美解决溢出 */
    .session-switch-group { 
        width: 100% !important; 
        order: 2 !important; 
        margin-top: 5px !important;
        
        /* ★ 核心修改：变成两列网格 ★ */
        display: grid !important;
        grid-template-columns: 1fr 1fr !important; 
        gap: 8px !important;
        
        background: transparent !important;
        padding: 0 !important;
        height: auto !important;
    }
    
    /* 按钮样式适配 */
    .session-btn { 
        width: 100% !important; /* 占满格子 */
        min-width: 0 !important;
        margin: 0 !important;
        text-align: center !important;
        border-radius: 8px !important;
        padding: 8px 0 !important;
        flex: none !important;
    }
    
    /* 4. 保存按钮 */
    .save-btn { width: 100% !important; order: 3; margin-top: 5px !important; }

    /* 5. 弹窗容器 */
    .modal-content { width: 95% !important; padding: 15px 12px !important; margin: 10px auto !important; overflow-x: hidden !important; }

    /* 6. 其他修正 */
    #modalSongs { flex-direction: column !important; gap: 0 !important; }
    .setlist-column { width: 100% !important; max-width: 100% !important; }
    .song-row { padding: 10px 5px !important; }
    .song-title { white-space: normal !important; word-break: break-word !important; font-size: 1.1em !important; }
    .song-cover-img { width: 60px !important; height: 60px !important; margin-right: 10px !important; }
    .song-left-col { width: 60px !important; margin-right: 10px !important; }
    #modalTitle { position: relative; z-index: 5 !important; text-shadow: 0 0 5px white; }
    .unit-watermark { opacity: 0.15 !important; z-index: 0 !important; }
    
    /* 修复出演者标签换行 */
    .performers-wrapper { flex-wrap: wrap !important; width: 100% !important; }
}